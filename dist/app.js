!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Hell=class{constructor(e){this.mirror=e,this.callbacks=new Set}add(e){this.callbacks.add(e),this.mirror&&this.mirror.add(e)}delete(e){this.callbacks.delete(e),this.mirror&&this.mirror.delete(e)}clear(e){this.callbacks.forEach(t=>{t(),this.delete(t),e&&e(t)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0);t.BuildsGridComponent=class{constructor(e,t){this.$dom=e,this.$config=t,this.prefix=`${this.$config.prefix}-grid`,this.styles=`\n        .${this.prefix} {\n          width: 100%;\n          height: 100%;\n          overflow: auto;\n        }\n        .${this.prefix} table {\n          width: 100%;\n          border-spacing: 0;\n        }\n        .${this.prefix} td, .${this.prefix} th {\n          border-bottom: 1px solid #aaa;\n          padding: 7px 5px;\n          text-align: center;\n        }\n        .${this.prefix} tbody tr {\n          cursor: pointer;\n          transition: background-color .25s ease-in-out;\n        }\n        .${this.prefix} tbody tr:hover {\n          background-color: #A1EEEA;\n          transition: background-color .15s ease-in-out;\n        }\n        .${this.prefix} tbody tr.selected {\n          background-color: #ABFFAB;\n        }\n      `,this.tdInterpolator=this.$dom.makeInterpolator("<td>{{ content }}</td>"),this.thInterpolator=this.$dom.makeInterpolator("<td>{{ content }}</td>"),this.rowInterpolator=this.$dom.makeInterpolator('\n    <tr class="{{ rowCssClasses }}" data-select-all="build">\n      <td>{{ id }}</td>\n      <td>{{ name }}</td>\n      <td>{{ date }}</td>\n      {{ dynamic }}\n    </tr>\n  '),this.gridRenderer=this.$dom.makeRenderer(`\n    <div class="${this.prefix}">\n      <table>\n        <thead>\n          <tr>\n            <th>#</th>\n            <th>Name</th>\n            <th>Date</th>\n            {{ dynamicHeadings }}\n          </tr>\n        </thead>\n        <tbody>{{ rows }}</tbody>\n      </table>\n    </div>\n  `),this.destroyCbs=new n.Hell,this.renderDestroyCbs=new n.Hell(this.destroyCbs),this.params={builds:[],selectedBuildIds:[],onBuildClick:()=>{}},this.paramKeys=Object.keys(this.params)}getRef(){return this.ref||this.render()}refresh(e){this.refreshParams(e),(e.selectedBuildIds||e.builds)&&this.render()}onBeforeInsert(){this.destroyCbs.add(this.$dom.insertGlobalStyles(this.styles))}onAfterInsert(){this.destroyCbs.add(this.$dom.addEventListener(this.ref.root$,"click",e=>{const t=e.target&&"TD"===e.target.nodeName&&"build"===e.target.parentElement.getAttribute("data-select-all")&&e.target.parentElement||void 0;if(!t)return;const i=Array.from(t.parentElement.children).indexOf(t);if(i<0)throw new Error("Can not find row index");const n=this.params.builds[i];if(!n)throw new Error("Can not find build by the row index");const s=this.params.selectedBuildIds.indexOf(n.id)>-1;this.params.onBuildClick({build:n,selected:s})}))}onBeforeRemove(){this.destroyCbs.clear()}onAfterRemove(){this.ref=void 0}render(){if(this.renderDestroyCbs.clear(),!this.params.builds)throw new Error("No builds param");const e=this.params.builds[0]&&Object.keys(this.params.builds[0].dynamic)||[],t=this.params.builds.map(t=>this.rowInterpolator(Object.assign({},t,{dynamic:e.map(e=>this.tdInterpolator({content:t.dynamic[e]})).join(""),rowCssClasses:this.params.selectedBuildIds.indexOf(t.id)>-1?"selected":""}))).join("\n"),i=e.map(e=>this.thInterpolator({content:e})).join("\n"),n=this.gridRenderer({rows:t,dynamicHeadings:i});return this.ref?(this.$dom.remove(Array.from(this.ref.root$.children)),this.$dom.append(this.ref,Array.from(n.root$.children)),this.ref.links=n.links,this.ref.linksAll=n.linksAll):this.ref=Object.assign({},n,{componentInstance:this,childComponentRefs:[]}),this.ref}refreshParams(e){this.paramKeys.filter(t=>void 0!==e[t]).forEach(t=>this.params[t]=e[t])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(3),s=i(4),r=i(9),o=i(10),d=i(11),a=i(12),l=new o.ConfigService;l.onInit();const c=new a.JenkinsService,h=new n.DomService,f=new d.DbService(l),u=new s.ModalsService(h,l,c,f),p=new r.AppService(u,f,c,l);f.onInit(),p.onInit()},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function d(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,d)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});t.DomService=class{constructor(){this.destroyCbs=new Set}onDestroy(){this.destroyCbs.forEach(e=>{e(),this.destroyCbs.delete(e)})}compile(e){const t=document.createElement("div");t.innerHTML=e;const i=t.children[0];if(!i)throw new Error("Can not compile HTML: "+e.slice(100));const n=new Array(...t.querySelectorAll("[data-select]")).reduce((e,t)=>{Object.assign(e);const i=t.getAttribute("data-select");return i?(e[i]&&console.warn(new Error("Multiple links with the same name: "+i)),e[i]=t,e):(console.warn(new Error("Empty data-select attribute")),e)},{}),s=new Array(...t.querySelectorAll("[data-select-all]")).reduce((e,t)=>{Object.assign(e);const i=t.getAttribute("data-select-all");return i?(e[i]||(e[i]=[]),e[i].push(t),e):(console.warn(new Error("Empty data-select-all attribute")),e)},{});return this.remove(i),{root$:i,links:n,linksAll:s}}append(e,t){return n(this,void 0,void 0,function*(){return t instanceof Array?Promise.all(t.map(t=>n(this,void 0,void 0,function*(){return yield this.appendOne(e,t)}))):yield this.appendOne(e,t)})}appendOne(e,t){return n(this,void 0,void 0,function*(){const i=this.isTemplateRef(e)?e.root$:e,n=this.isTemplateRef(t)?t.root$:t,s=this.isComponentRef(t)?t.componentInstance:void 0;return s&&s.onBeforeInsert&&(yield s.onBeforeInsert()),i.appendChild(n),s&&s.onAfterInsert&&(yield s.onAfterInsert()),t})}remove(e){return n(this,void 0,void 0,function*(){return e instanceof Array?Promise.all(e.map(e=>n(this,void 0,void 0,function*(){return yield this.removeOne(e)}))):yield this.removeOne(e)})}removeOne(e){return n(this,void 0,void 0,function*(){const t=this.isTemplateRef(e)?e.root$:e,i=t.parentElement||void 0,n=this.isComponentRef(e)?e.componentInstance:void 0;return i&&(n&&n.onBeforeRemove&&(yield n.onBeforeRemove()),i.removeChild(t),n&&n.onAfterRemove&&(yield n.onAfterRemove())),e})}insertGlobalStyles(e){const t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t);const i=()=>this.remove(t);return this.destroyCbs.add(i),()=>{i(),this.destroyCbs.delete(i)}}sanitizeAttrValue(e){return String(e).replace(/['" ]/g,"_")}sanitizeHtml(e){return String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;")}addEventListener(e,t,i,n){return e.addEventListener(t,i,n),()=>e.removeEventListener(t,i)}interpolate(e,t){return this.makeInterpolator(e)(t)}makeInterpolator(e){return t=>Object.keys(t).reduce((e,i)=>e.replace(new RegExp(`{{\\s*${i}\\s*}}`,"g"),void 0!==t[i]?String(t[i]):""),e)}makeRenderer(e){const t=this.makeInterpolator(e);return(e={})=>this.compile(t(e))}isComponentRef(e){return!(!e.root$||!e.componentInstance)}isTemplateRef(e){return!(!e.root$||!e.linksAll)}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function d(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,d)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=i(5);t.ModalsService=class{constructor(e,t,i,n){this.$dom=e,this.$config=t,this.$jenkins=i,this.$db=n,this.isMainGridOpened=!1}alert(e,t="Warning!"){const i=new s.MainModalComponent(this.$dom,this.$config),n={title:t,content:[document.createTextNode(e)],size:"smw"};i.insertToBody(n)}openMainGrid(){return n(this,void 0,void 0,function*(){const e=new s.MainModalComponent(this.$dom,this.$config),t=[{name:"Clear",tooltip:"Clear whole retrieved for the builds",cb:()=>{this.$db.clearCurrentBuildJob(),n(),f()}},{name:"Compare",cb:()=>{const e=this.$db.compareTwoSelectedBuild();this.openComparisonModal(e)}},{name:"Retrieve",cb:()=>{const e=this.$jenkins.retrieveBuild();this.$db.saveBuild(e),n(),f()}},{name:"Cancel",tooltip:"Just closes the modal",cb:({close:e})=>{e()}}],i=new s.BuildsGridComponent(this.$dom,this.$config);i.refresh({onBuildClick:({build:e,selected:t})=>{this.$db.toggleBuildSelection(e.id,!t),n(),h()}});const n=()=>{const e=this.$db.getAllBuilds(),t=this.$db.getSelectedBuildIds();i.refresh({builds:e,selectedBuildIds:t})};n();const r={content:[i.getRef()],actions:t,size:"lg",title:"Failed Tests Comparator",onAfterInsert:()=>this.isMainGridOpened=!0,onBeforeRemove:()=>this.isMainGridOpened=!1},o=(yield e.insertToBody(r)).linksAll.action.map(e=>[parseInt(e.getAttribute("data-action-button-idx")||"",10),e]).sort(([e],[t])=>+e-+t).map(([,e])=>e),d=o[0],a=o[1],l=o[2],c=this.$jenkins.isPageHasInfoAboutFailedTests();l.disabled=!c,l.title=c?"Retrieve build info from the current page and save to compare in the future":"This page doesn't have any information about failed tests";const h=()=>{const e=2===this.$db.getSelectedBuildIds().length;a.disabled=!e,a.title=e?"Compare two selected builds":"Select two builds first"},f=()=>{const e=this.$db.getAllBuilds().length>0;d.disabled=!e};h(),f()})}openComparisonModal(e){const t=new s.ComparisonComponent(this.$dom,this.$config);t.refresh({result:e});const i={content:[t.getRef()],size:"lg",title:"Comparison Results"};new s.MainModalComponent(this.$dom,this.$config).insertToBody(i)}}},function(e,t,i){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i(1)),n(i(6)),n(i(7))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),s=i(1);t.ComparisonComponent=class{constructor(e,t){this.$dom=e,this.$config=t,this.prefix=`${this.$config.prefix}-comparison`,this.styles=`\n        .${this.prefix} {\n          width: 100%;\n          height: 100%;\n          overflow: auto;\n        }\n        .${this.prefix}-failed-list a {\n          color: #666;\n          text-decoration: none;\n        }\n        .${this.prefix}-failed-list a:hover {\n          color: #000;\n          text-decoration: underline;\n        }\n      `,this.testInterpolator=this.$dom.makeInterpolator('<a href="{{ link }}" target="_blank">{{ id }}</a>'),this.mainRenderer=this.$dom.makeRenderer(`\n    <div class="${this.prefix}">\n      <div class="${this.prefix}-grid" data-select="grid"></div>\n\n      <h3 class="${this.prefix}-heading">All Failed Tests in #{{ firstId }} ({{ firstFailedCount }}):</h3>\n      <div class="${this.prefix}-failed-list">{{ firstFailed }}</div>\n\n      <h3 class="${this.prefix}-heading">All Failed Tests in #{{ secondId }} ({{ secondFailedCount }}):</h3>\n      <div class="${this.prefix}-failed-list">{{ secondFailed }}</div>\n\n      <h3 class="${this.prefix}-heading">Tests Failed in #{{ firstId }}, but passed in #{{ secondId }} ({{ onlyFirstFailedCount }}):</h3>\n      <div class="${this.prefix}-failed-list">{{ onlyFirstFailed }}</div>\n\n      <h3 class="${this.prefix}-heading">Tests Failed in #{{ secondId }}, but passed in #{{ firstId }} ({{ onlySecondFailedCount }}):</h3>\n      <div class="${this.prefix}-failed-list">{{ onlySecondFailed }}</div>\n\n      <h3 class="${this.prefix}-heading">Tests Failed in both builds ({{ bothFailedCount }}):</h3>\n      <div class="${this.prefix}-failed-list">{{ bothFailed }}</div>\n    </div>\n  `),this.destroyCbs=new n.Hell,this.renderDestroyCbs=new n.Hell(this.destroyCbs),this.params={result:void 0},this.paramKeys=Object.keys(this.params)}getRef(){return this.ref||this.render()}refresh(e){this.refreshParams(e),e.result&&this.render()}onBeforeInsert(){this.destroyCbs.add(this.$dom.insertGlobalStyles(this.styles))}onBeforeRemove(){this.destroyCbs.clear()}onAfterRemove(){this.ref=void 0}render(){if(this.renderDestroyCbs.clear(),!this.params.result)throw new Error("No .result param");const e=this.params.result,t=this.makeFailedTestsListHtml(e.first.failedTests),i=this.makeFailedTestsListHtml(e.second.failedTests),n=this.makeFailedTestsListHtml(e.onlyFirst),r=this.makeFailedTestsListHtml(e.onlySecond),o=this.makeFailedTestsListHtml(e.both),d=e.first.failedTests.length,a=e.second.failedTests.length,l=e.onlyFirst.length,c=e.onlySecond.length,h=e.both.length,f=this.mainRenderer({firstId:e.first.id,secondId:e.second.id,firstFailed:t,secondFailed:i,onlyFirstFailed:n,onlySecondFailed:r,bothFailed:o,firstFailedCount:d,secondFailedCount:a,onlyFirstFailedCount:l,onlySecondFailedCount:c,bothFailedCount:h}),u=new s.BuildsGridComponent(this.$dom,this.$config);u.refresh({builds:[e.first,e.second]});const p=u.getRef();return this.$dom.append(f.links.grid,p),this.renderDestroyCbs.add(()=>this.$dom.remove(p)),this.ref?(this.$dom.remove(Array.from(this.ref.root$.children)),this.$dom.append(this.ref,Array.from(f.root$.children)),this.ref.links=f.links,this.ref.linksAll=f.linksAll):this.ref=Object.assign({},f,{componentInstance:this,childComponentRefs:[]}),this.ref}refreshParams(e){this.paramKeys.filter(t=>void 0!==e[t]).forEach(t=>this.params[t]=e[t])}makeFailedTestsListHtml(e){return e.map(e=>this.makeAnchorHtml(e)).join(" ")}makeAnchorHtml(e){return this.testInterpolator({id:e.id,link:this.makeJiraLink(e.id)})}makeJiraLink(e){const t=e.replace("_","-");return this.$config.jiraUrl?`${this.$config.jiraUrl}/browse/${t}`:""}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function d(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,d)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=i(8),r=i(0);class o{constructor(e,t){this.$dom=e,this.$config=t,this.prefix=`${this.$config.prefix}-main-modal`,this.transitionTimeMs=200,this.openedBodyCssClass=`${this.prefix}-opened`,this.openedBackdropCssClass=`${this.prefix}-backdrop--opened`,this.params={content:[],title:"",size:"md",styles:"",actions:[{name:"OK",cb:({close:e})=>e()}],onAfterInsert:()=>{},onBeforeRemove:()=>{}},this.paramKeys=Object.keys(this.params),this.isShown=!1,this.isPending=!1,this.lastDestroyCbs=new r.Hell,this.destroyCbs=new r.Hell,this.renderDestroyCbs=new r.Hell(this.destroyCbs),this.styles=`\n      body > * {\n        transition: filter ${this.transitionTimeMs}ms ease-in-out;\n      }\n      body.${this.openedBodyCssClass} > * {\n        filter: blur(4px);\n      }\n\n      body.${this.openedBodyCssClass} > .${this.prefix}-backdrop {\n        filter: none;\n      }\n      body.${this.openedBodyCssClass} {\n        overflow: hidden;\n      }\n\n      /* Ripple effect */\n      .${this.prefix} .ripple {\n        background-position: center;\n        transition: background 0.8s;\n      }\n      .${this.prefix} .ripple:hover {\n        background: #47a7f5 radial-gradient(circle, transparent 1%, #47a7f5 1%) center/15000%;\n      }\n      .${this.prefix} .ripple:active {\n        background-color: #6eb9f7;\n        background-size: 100%;\n        transition: background 0s;\n      }\n\n      .${this.prefix}-backdrop {\n        position: fixed;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 10000000;\n        \n        transition: background-color ${this.transitionTimeMs}ms ease-in-out;\n        background-color: transparent;\n      }\n      .${this.openedBackdropCssClass} {\n        filter: none;\n        background-color: rgba(0, 0, 0, 0.1);\n      }\n      .${this.prefix} {\n        display: flex;\n        flex-direction: column;\n        box-shadow: 0 0 40px 0 rgba(0,0,0,0.5);\n        background: #fff;\n        margin-top: 100%;\n        opacity: 0;\n        transition: all ${this.transitionTimeMs}ms ease-in-out;\n        border-radius: 2px;\n      }\n      .${this.openedBackdropCssClass} .${this.prefix} {\n        margin-top: 0;\n        opacity: 1;\n      }\n      .${this.prefix}--smw {\n        width: 400px;\n      }\n      .${this.prefix}--sm {\n        width: 400px;\n        height: 300px;\n      }\n      .${this.prefix}--md {\n        width: 600px;\n        height: 400px;\n      }\n      .${this.prefix}--lg {\n        width: 900px;\n        height: 550px;\n      }\n      .${this.prefix}__header {\n        height: 44px;\n        flex: 0 0 44px;\n        padding: 12px 30px;\n        overflow: hidden;\n        background-color: #2196f3;\n      }\n      .${this.prefix}__title {\n        margin: 1px 0;\n        color: #fff;\n      }\n      .${this.prefix}__close {\n        font-size: 28px;\n        display: block;\n        float: right;\n        width: 30px;\n        height: 30px;\n        line-height: 27px;\n        border-radius: 50%;\n        text-align: center;\n        margin-top: -5px;\n        margin-right: -7px;\n\n        color: #fff;\n        font-weight: bold;\n        cursor: pointer;\n      }\n      .${this.prefix}__content {\n        padding: 12px 30px;\n        flex: 1 0 auto;\n        height: 100px;\n      }\n      .${this.prefix}__actions {\n        flex: 0 0 66px;\n        height: 66px;\n        display: flex;\n        justify-content: flex-end;\n        padding: 15px;\n      }\n      .${this.prefix}__action {\n        padding: 0 35px;\n        font-family: 'Montserrat', Arial, Helvetica, sans-serif;\n        text-align: center;\n        text-decoration: none;\n        /*text-transform: capitalize;*/\n        color: white;\n        border-radius: 2px;\n        border: none;\n        font-weight: bold;\n        font-size: 1.2em;\n        height: 100%;\n        line-height: 38px;\n        cursor: pointer;\n        color: white;\n        background-color: #2196f3;\n        box-shadow: 0 0 4px #999;\n        outline: none;\n      }\n      * + .${this.prefix}__action {\n        margin-left: 15px;\n      }\n      .${this.prefix}__action:disabled {\n        background-color: #70BFFF !important;\n        cursor: not-allowed;\n      }\n    `,this.backdropRenderer=this.$dom.makeRenderer(`<div class="${this.prefix}-backdrop"></div>`),this.actionButtonInterpolator=this.$dom.makeInterpolator(`\n      <button class="${this.prefix}__action ripple"\n              title="{{ tooltip }}"\n              data-select-all="action"\n              data-action-button-idx="{{ actionButtonIdx }}"\n      >{{ name }}</button>\n  `),this.modalRenderer=this.$dom.makeRenderer(`\n    <div class="${this.prefix} ${this.prefix}--{{ size }}" data-select="modal">\n      <div class="${this.prefix}__header">\n        <a role="button" class="${this.prefix}__close ripple" data-select="close">&times;</a>\n        <h3 class="${this.prefix}__title">{{ title }}</h3>\n      </div>\n      <div class="${this.prefix}__content" data-select="content"></div>\n      <div class="${this.prefix}__actions" data-select="actions">{{ actions }}</div>\n    </div>\n  `)}get isInserted(){return o.openedModalRefs.has(this)}insertToBody(e){return n(this,void 0,void 0,function*(){if(this.isInserted)throw new Error("An attempt to insert the same MainModalComponent instance twice");o.openedModalRefs.add(this),this.refreshParams(e);const t=yield this.render(!0);return this.$dom.append(document.body,t)})}remove(){return n(this,void 0,void 0,function*(){if(!this.isInserted)throw new Error("An attempt to remove not inserted MainModalComponent");yield this.$dom.remove(this.ref),this.ref=void 0,o.openedModalRefs.delete(this)})}refresh(e){return n(this,void 0,void 0,function*(){this.refreshParams(e),this.isInserted&&(yield this.render())})}onAfterInsert(){this.params.styles&&this.destroyCbs.add(this.$dom.insertGlobalStyles(this.params.styles)),1===o.openedModalRefs.size&&(this.lastDestroyCbs.add(this.$dom.insertGlobalStyles(this.styles)),this.bindEscToClose()),this.bindEvents(this.ref),this.params.onAfterInsert(this.ref),setTimeout(()=>this.toggle(!0))}onBeforeRemove(){return n(this,void 0,void 0,function*(){(yield this.toggle(!1))&&(this.params.onBeforeRemove(this.ref),yield this.$dom.remove(this.ref.childComponentRefs),1===o.openedModalRefs.size&&this.lastDestroyCbs.clear(),this.destroyCbs.clear())})}toggle(e){return n(this,void 0,void 0,function*(){if(this.isPending||!this.isInserted)return Promise.resolve(!1);if(this.isShown===e)return Promise.resolve(!0);this.isPending=!0,this.isShown=e;const t=1===o.openedModalRefs.size;t&&e&&(document.body.classList.add(this.openedBodyCssClass),yield s.later(this.transitionTimeMs));const i=this.ref.root$;return e?i.classList.add(this.openedBackdropCssClass):i.classList.remove(this.openedBackdropCssClass),t&&!e&&(yield s.later(this.transitionTimeMs),document.body.classList.remove(this.openedBodyCssClass)),yield s.later(this.transitionTimeMs),this.isPending=!1,!0})}render(e=!1){return n(this,void 0,void 0,function*(){if(this.renderDestroyCbs.clear(),e){const e=this.backdropRenderer();this.ref=Object.assign({},e,{componentInstance:this,childComponentRefs:[]})}else{if(!this.ref)throw new Error(".render() No .ref");yield this.$dom.remove(this.ref.links.modal),this.ref.links={},this.ref.linksAll={}}const t=this.params.actions.map(({name:e,tooltip:t},i)=>this.actionButtonInterpolator({name:e,tooltip:void 0!==t?this.$dom.sanitizeAttrValue(t):"",actionButtonIdx:i})).join(""),i=this.modalRenderer({actions:t,size:this.params.size,title:this.params.title});yield this.$dom.append(this.ref,i),this.ref.links=Object.assign({},this.ref.links,i.links),this.ref.linksAll=Object.assign({},this.ref.linksAll,i.linksAll);const n=this.ref.links.content,s=this.params.content;yield this.$dom.append(n,s),this.renderDestroyCbs.add(()=>this.$dom.remove(s));const r=s.filter(e=>this.$dom.isComponentRef(e));return this.ref.childComponentRefs.push(...r),this.ref})}bindEvents(e){const t={component:this,close:()=>this.remove()};e.linksAll.action.forEach(e=>{const i=e.getAttribute("data-action-button-idx");if(null===i)throw new Error("Action doesn't have data-action-button-idx attribute");const n=this.params.actions[+i];if(!n)throw new Error(`Can not find button definition by index: ${i}`);this.destroyCbs.add(this.$dom.addEventListener(e,"click",i=>n.cb(Object.assign({},t,{event:i,button$:e}))))}),this.destroyCbs.add(this.$dom.addEventListener(e.links.close,"click",()=>this.remove()))}bindEscToClose(){const e=this.$dom.addEventListener(document,"keydown",e=>{if("Escape"!==e.code)return;const t=this.getLastInsertedMainModal();if(!t)throw new Error("Don't have last inserted MainModalComponent, but Esc event not removed");t.remove()});this.lastDestroyCbs.add(e)}refreshParams(e){this.paramKeys.filter(t=>void 0!==e[t]).forEach(t=>this.params[t]=e[t])}getLastInsertedMainModal(){let e;for(e of o.openedModalRefs);return e}}o.openedModalRefs=new Set,t.MainModalComponent=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.later=(e,t)=>new Promise(i=>setTimeout(i,e,t))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AppService=class{constructor(e,t,i,n){this.$modals=e,this.$db=t,this.$jenkins=i,this.$config=n}onInit(){this.initDb(),this.buildOpenHotKey()}buildOpenHotKey(){const e=this.$config.hotKeys.openMainModal;document.addEventListener("keypress",t=>{if(!this.$db.hasSelectedBuildJob)return this.$modals.alert("Please, open a build job first.");t.code===`Key${e.key}`&&t.altKey===e.alt&&t.ctrlKey===e.ctrl&&t.shiftKey===e.shift&&!this.$modals.isMainGridOpened&&this.$modals.openMainGrid()});const t=(e.ctrl?"Ctrl+":"")+(e.alt?"Alt+":"")+(e.shift?"Shift+":"")+e.key;console.info(`[Failed Test Comparator] loaded\nPress ${t} to open`)}initDb(){const e=this.$jenkins.retrieveBuildJobName();e&&this.$db.selectBuildJob(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ConfigService=class{constructor(){this.jiraUrl="",this.prefix="ftc",this.dbName=`${this.prefix}-db`,this.hotKeys={openMainModal:{ctrl:!0,alt:!0,shift:!0,key:"Z"}}}onInit(){const e=window.ftcConfig&&window.ftcConfig.hotKeys&&window.ftcConfig.hotKeys.openMainModal;e&&(this.validateHotKey(e)?this.hotKeys.openMainModal=e:console.warn(new Error(".openMainModal Hot Key is invalid."),e));const t=window.ftcConfig&&window.ftcConfig.jiraUrl;t?this.jiraUrl=t:console.error("Please specify .jiraUrl in the config. I can't build URL for tickets")}validateHotKey(e){return e&&"object"==typeof e&&"boolean"==typeof e.ctrl&&"boolean"==typeof e.alt&&"boolean"==typeof e.shift&&"string"==typeof e.key&&/^[A-Z]$/.test(e.key)}}},function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i};Object.defineProperty(t,"__esModule",{value:!0});t.DbService=class{constructor(e){this.$config=e,this.data=this.makeInitialDb()}get hasSelectedBuildJob(){return!!this.currentBuildJobName}getCurrentBuildJob(){if(!this.currentBuildJobName)throw new Error("An attempt to access current build job until the job selected");return this.data.byBuildJob[this.currentBuildJobName]}onInit(){this.load()}getBuildById(e){return this.getCurrentBuildJob().builds[e]}getAllBuilds(){const e=this.getCurrentBuildJob();return e.buildsOrder.map(t=>e.builds[t])}saveBuild(e){const t=this.getCurrentBuildJob(),i=!!t.builds[e.id];t.builds[e.id]=e,i||(t.buildsOrder.push(e.id),t.buildsOrder.sort((e,t)=>t-e)),this.save()}getSelectedBuildIds(){const e=this.getCurrentBuildJob();return Object.keys(e.selectedBuildIds).map(e=>+e)}toggleBuildSelection(e,t){const i=this.getCurrentBuildJob(),s=Object.keys(i.selectedBuildIds).length;if(t)i.selectedBuildIds[e]=!0;else{const t=i.selectedBuildIds,s=e,r=(t[s],n(t,["symbol"==typeof s?s:s+""]));i.selectedBuildIds=r}Object.keys(i.selectedBuildIds).length!==s&&this.save()}selectBuildJob(e){this.currentBuildJobName=e,this.data.byBuildJob[this.currentBuildJobName]||(this.data.byBuildJob[this.currentBuildJobName]=this.makeEmptyBuildJob(),this.save())}compareTwoSelectedBuild(){const e=this.getSelectedBuildIds();if(2!==e.length)throw new Error(`Comparison requires 2 build selected. Now ${e.length} build selected`);const[t,i]=e.map(e=>this.getBuildById(e)),n=t.failedTests.filter(e=>!i.failedTests.some(t=>t.id===e.id)),s=i.failedTests.filter(e=>!t.failedTests.some(t=>t.id===e.id)),r=t.failedTests.filter(e=>i.failedTests.some(t=>t.id===e.id));return{first:t,second:i,onlyFirst:n,onlySecond:s,both:r}}clearCurrentBuildJob(){const e=this.getCurrentBuildJob();e.selectedBuildIds=[],e.builds={},e.buildsOrder=[],this.save()}save(){const e="function"==typeof Object.toJSON?Object.toJSON(this.data):JSON.stringify(this.data);localStorage.setItem(this.$config.dbName,e)}load(){const e=localStorage.getItem(this.$config.dbName);this.data=e?JSON.parse(e):this.makeInitialDb()}makeInitialDb(){return{version:1,byBuildJob:{}}}makeEmptyBuildJob(){return{builds:{},buildsOrder:[],selectedBuildIds:{}}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.JenkinsService=class{isPageHasInfoAboutFailedTests(){return!!document.querySelector('a[href="testReport/"]')}retrieveBuild(){if(!this.isPageHasInfoAboutFailedTests())throw new Error("The page doesn't contain any info about failed tests");return Object.assign({},this.retrieveBuildInfo(),{failedTests:this.retrieveFailedTests()})}retrieveBuildJobName(){const e=location.pathname.replace(/^((?:\/job\/[\w-]+)+).*?$/,"$1");return e.length>5?e:void 0}retrieveBuildInfo(){const e=document.querySelector("h1");if(!e||!e.textContent)throw new Error("Can't find <h1> or it hasn't .textContent");const t=e.textContent.match(/Build (?<id>\d+):\s+(?<name>\w+)\s*\((?<date>[^()]+)\)/);if(!t)throw new Error("Can not parse <h1>");const{id:i,name:n,date:s}=t.groups,r=document.querySelector("#description");if(!r)throw new Error("Can't find #description");return{id:+i,name:n,date:s,dynamic:r.innerText.split("\n").map(e=>e.split(/\s*:\s*/)).reduce((e,[t,i])=>Object.assign({},e,{[t]:i}),{})}}retrieveFailedTests(){const e=document.querySelectorAll('a[href="testReport/"] + ul a[href^="testReport/junit/"]');return new Array(...e).map(e=>(e.textContent||"").replace(/^.+?([A-Z]{2,10}_\d+).+?$/,"$1")).map(e=>({id:e}))}}}]);
//# sourceMappingURL=app.js.map